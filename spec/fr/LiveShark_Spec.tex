\documentclass[11pt]{article}

\input{../common/liveshark-style.tex}
\input{../common/liveshark-macros.tex}

% --- Langue (XeLaTeX) ---
\usepackage{polyglossia}
\setdefaultlanguage{french}

% --- Mots-clés normatifs en français (intention BCP 14 / RFC 2119 & RFC 8174) ---
\newcommand{\DOIT}{\textbf{DOIT}}
\newcommand{\NEDOITPAS}{\textbf{NE DOIT PAS}}
\newcommand{\DEVRAIT}{\textbf{DEVRAIT}}
\newcommand{\NEDEVRAITPAS}{\textbf{NE DEVRAIT PAS}}
\newcommand{\PEUT}{\textbf{PEUT}}

% Titres standards en français
\addto\captionsfrench{
  \renewcommand{\contentsname}{Sommaire}
}

\usepackage{csquotes}
\usepackage{biblatex}
\addbibresource{../common/references.bib}

\title{\sffamily\bfseries\color{LSBlue}LiveShark\\\large Spécification (PDF imprimable) v0.1}
\author{\sffamily Florian Keller}
\date{\sffamily Brouillon — \today}

\begin{document}
\maketitle

\paragraph{Note de langue.} Cette version française est une traduction destinée à faciliter la relecture. En cas de divergence, la version anglaise (EN) est la référence pour les IDs d’exigences et les contrats, sauf décision explicite contraire.\\

\vspace{-1.0em}

\begin{tcolorbox}
\textbf{Périmètre.} LiveShark est un analyseur \textbf{passif} pour les réseaux de contrôle de spectacle (Art-Net, sACN).
Il se concentre sur l'\textbf{analyse hors-ligne de captures PCAP}, la \textbf{reconstruction de trames DMX},
la \textbf{détection automatique de conflits} et des \textbf{rapports reproductibles}.\\
\textbf{Public.} Le texte vise aussi des \textbf{non-spécialistes du développement logiciel} (techniciens lumière, intégrateurs, QA).
Un \textbf{mode suivi} est prévu pour une analyse en quasi temps réel d'un fichier de capture en cours d'écriture (outil externe).\\
L'interface idéale pour l'utilisateur final est une \textbf{interface graphique (GUI)} bien conçue ; l'\textbf{interface en ligne de commande (CLI)} reste scriptable et produit les mêmes données.
\end{tcolorbox}

\newpage
\tableofcontents
\newpage

\section{Terminologie et conventions}

\subsection{Version de référence et politique de traduction}
\textbf{Version de référence (fait foi).} La spécification anglaise dans \texttt{spec/en} est la \emph{version de référence} :
en cas de divergence ou de traduction incomplète, \textbf{la version anglaise fait foi}.\\
\textbf{Traduction indicative (best-effort).} La version française dans \texttt{spec/fr} est une aide à la relecture et peut être
\textbf{en retard}. En cas de différence, la version de référence prévaut.

\subsection{Mots-clés normatifs}
Les mots-clés \DOIT, \NEDOITPAS, \DEVRAIT, \NEDEVRAITPAS{} et \PEUT{} sont à interpréter au sens de la BCP 14
(RFC 2119 et RFC 8174). Seule l'écriture en \textbf{MAJUSCULES} est normative.

\subsection{Note sur le langage d'implémentation}
LiveShark est développé en \textbf{Rust} pour concilier \textbf{sécurité mémoire}, \textbf{performances} et
\textbf{portabilité} (Windows, macOS, Linux) avec un outillage moderne. Il s'agit d'un choix d'ingénierie pour v0.1
et cela n'exclut pas l'usage d'autres langages pour des composants futurs si cela se justifie.
Le code Rust DEVRAIT suivre le guide de style officiel : \texttt{https://doc.rust-lang.org/style-guide/}.

\subsection{Note sur le terme \enquote{Live}}
Dans le nom du projet, \enquote{Live} fait référence au \textbf{spectacle vivant / contrôle de spectacle} (réseaux lumière), et non à une
garantie de capture en temps réel. La capture en temps réel est optionnelle et pourra être introduite dans des versions ultérieures.
Le diagnostic en quasi temps réel peut être atteint via le mode suivi, sans capture native immédiate.

\subsection{Termes de base}
\begin{tabularx}{\linewidth}{@{}l X@{}}
\toprule
\textbf{Terme} & \textbf{Signification} \\
\midrule
Paquet & Paquet réseau capturé dans un fichier PCAP/PCAPNG. \\
Message protocolaire & Unité décodée au niveau applicatif (ex. ArtDMX, sACN Data Packet). \\
Trame DMX & État DMX512 (512 slots) reconstruit pour un univers à un instant donné. \\
Univers & Groupe logique de jusqu'à 512 slots DMX. \\
Source & Émetteur identifié par IP et, si applicable, par identifiant protocolaire (ex. CID sACN). \\
Flux & Tuple unidirectionnel (proto, src ip:port, dst ip:port). \\
\bottomrule
\end{tabularx}

\subsection{Acronymes}
\begin{tabularx}{\linewidth}{@{}l X@{}}
\toprule
\textbf{Acronyme} & \textbf{Développement} \\
\midrule
ArtDMX & Paquet de données DMX Art-Net \\
Art-Net & Protocole Art-Net \\
BCP & Best Current Practice (bonnes pratiques actuelles) \\
CC-BY-4.0 & Creative Commons Attribution 4.0 International \\
CID & Component Identifier (identifiant de source sACN) \\
CI & Intégration continue \\
CLI & Interface en ligne de commande \\
DMX & Digital Multiplex (DMX512 / DMX512-A) \\
DMX512 & Digital Multiplex 512 \\
DoD & Definition of Done (critère de fin) \\
FPS / PPS / BPS & Trames / Paquets / Octets par seconde \\
GUI & Interface graphique \\
IP & Internet Protocol (Protocole Internet) \\
JSON & JavaScript Object Notation \\
MIT & Licence MIT \\
MVP & Minimum Viable Product (produit minimum viable) \\
PCAP & Packet Capture \\
PCAPNG & PCAP Next Generation \\
QA & Assurance qualité \\
RFC & Request for Comments \\
sACN & Streaming ACN (ANSI E1.31) \\
UDP & User Datagram Protocol \\
\bottomrule
\end{tabularx}

\section{Ce que LiveShark est (et n'est pas)}

\subsection{Objectifs}
\begin{itemize}
  \item Analyse hors-ligne de captures PCAP/PCAPNG pour Art-Net et sACN.
  \item Reconstruction de trames DMX (512 slots) et métriques (fps, pps/bps, gigue, pertes, rafales).
  \item Détection automatique de \textbf{conflits} (sources multiples sur un même univers avec chevauchement).
  \item Rapports JSON versionnés et reproductibles pour tickets, a posteriori, QA et CI.
\end{itemize}

\paragraph{Entrée capture (Wireshark non requis).}
LiveShark \NEDOITPAS{} exiger l’application Wireshark (interface graphique) pour fonctionner.
En v0.1, l’entrée est un fichier PCAP/PCAPNG produit par des outils standards (p.\,ex. \texttt{tcpdump} sous Linux, \texttt{pktmon} sous Windows, ou tout outil de capture exportant PCAP/PCAPNG).
La capture live est un objectif futur et \PEUT{} être ajoutée plus tard via libpcap/Npcap (sans changer le schéma de rapport).

\subsection{Stratégie \emph{hors ligne en priorité} (intention produit)}
LiveShark est conçu comme un analyseur \emph{hors ligne en priorité} : les premières versions se concentrent sur l'analyse a posteriori
de captures PCAP/PCAPNG afin de maximiser la robustesse, la reproductibilité et la simplicité de support.
Il s'agit d'un choix d'ingénierie volontaire, et non d'une limitation produit.
La capture live / l'analyse en ligne est un objectif futur explicite et \PEUT{} être implémentée une fois le cœur offline validé.

\textbf{Compatibilité future.} Le pipeline d'analyse \DOIT{} être architecturé afin que l'entrée des paquets puisse provenir :
(a) d'un lecteur de fichiers (PCAP/PCAPNG), ou (b) d'une source de capture live (future).
Aucune hypothèse « offline uniquement » \NEDOITPAS{} être intégrée au modèle métier (trames, conflits, rapports).

Le mode suivi constitue une trajectoire pragmatique pour un diagnostic fiable pendant la préparation du spectacle et pendant le spectacle :
il analyse un fichier de capture au fur et à mesure de son écriture, sans imposer une capture native immédiate. L'outil vise à
fournir des \emph{indices de causes probables} sur la base d'éléments observables (pertes, gigue, rafales), au mieux.
La localisation précise des pertes peut nécessiter plusieurs points de capture (par exemple avant/après un segment sans fil).

\subsection{Non-objectifs}
\begin{itemize}
  \item LiveShark ne vise \textbf{pas} à remplacer Wireshark.
  \item LiveShark est \textbf{passif} : il n'injecte pas de trafic.
  \item ``Laser over IP'' démarre en mode \textbf{métriques de flux UDP} uniquement ; la reconstruction de trames laser est hors scope v0.1.
\end{itemize}

\section{Architecture (concept)}
\begin{figure}[H]
\centering
\begin{adjustbox}{max width=\linewidth}
\input{../common/figures/dataflow.tex}
\end{adjustbox}
\caption{Pipeline conceptuel d'analyse hors-ligne (niveau élevé).}
\textit{Note :} Le pipeline accepte actuellement (v0.1) uniquement des fichiers PCAP/PCAPNG. L'entrée depuis une capture live
est un objectif futur (v0.3+) conforme à l'exigence LS-ARCH-001.
\end{figure}

\section{Métriques (valeurs par défaut)}
Par défaut :
\begin{itemize}
  \item \textbf{Fenêtre pps/bps :} 1.0 s (glissante)
  \item \textbf{Fenêtre fps :} 5.0 s (glissante)
  \item \textbf{Fenêtre gigue :} 10.0 s (glissante) (référence conceptuelle : RFC 3550)
\end{itemize}

\section{Exigences contractuelles (extrait)}
Ce document est une base de démarrage : les exigences sont volontairement minimales.

\subsection{Priorité P0 (fondations MVP)}
\begin{reqbox}{LS-ARCH-001}{P0}{}
Le cœur \DOIT{} exposer une abstraction d’entrée paquets/événements afin que l’analyse puisse être alimentée par :
(a) un lecteur PCAP/PCAPNG (v0.1), et (b) une source de capture live (future), sans modifier le modèle métier ni le schéma de rapport.
\end{reqbox}

\begin{reqbox}{LS-PROD-001}{P0}{}
LiveShark \NEDOITPAS{} exiger l’application Wireshark (interface graphique). Il \DOIT{} accepter des fichiers PCAP/PCAPNG produits par des outils de capture standards.
\end{reqbox}

\begin{reqbox}{LS-FR-001}{P0}{}
LiveShark \DOIT{} ingérer des fichiers PCAP/PCAPNG et lister les flux UDP.
\end{reqbox}

\begin{reqbox}{LS-FR-010}{P0}{}
LiveShark \DOIT{} décoder Art-Net ArtDMX et reconstruire des trames DMX (512 slots) par univers.
\end{reqbox}

\begin{reqbox}{LS-FR-011}{P0}{}
LiveShark \DOIT{} décoder sACN (E1.31) et reconstruire des trames DMX par univers.
\end{reqbox}

\subsection{Priorité P1 (différenciateurs critiques)}
\begin{reqbox}{LS-CONF-001}{P1}{}
LiveShark \DOIT{} détecter les sources concurrentes : deux sources ou plus sur le même univers avec chevauchement $> 1.0$ s.
\end{reqbox}

\begin{reqbox}{LS-REP-001}{P1}{}
LiveShark \DOIT{} générer un rapport JSON versionné contenant au minimum : résumé capture, univers, sources, flux et conflits.
\end{reqbox}

\section{Critères de validation (extrait)}

\subsection{Definition of Done v0.1}
Le MVP est considéré livré si :
\begin{enumerate}
  \item \texttt{liveshark pcap analyse file.pcapng} fonctionne sur 3 captures.
  \item Art-Net et sACN sont décodés (univers, sources, fps).
  \item Le rapport JSON contient \texttt{conflicts[]} (détection auto).
  \item Aucun crash sur PCAP tronqué/corrompu.
\end{enumerate}

\subsection{Tests golden}
Format : \texttt{tests/golden/<nom>/\{input.pcapng, expected\_report.json\}}.

\section{Licence}
Le code est sous licence \textbf{MIT OR Apache-2.0}. La documentation et les specifications sont sous licence \textbf{CC-BY-4.0}.
Les fichiers PDF sont des artefacts de build générés depuis les sources \texttt{.tex} et \textbf{ne doivent pas être committés} dans le dépôt.

\section{Références normatives}
\begin{tabularx}{\linewidth}{@{}l X@{}}
\toprule
\textbf{Référence} & \textbf{Titre} \\
\midrule
RFC 2119 & Key words for use in RFCs to Indicate Requirement Levels \\
RFC 8174 & Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words \\
RFC 3550 & RTP: A Transport Protocol for Real-Time Applications \\
ANSI E1.31-2018 & Streaming ACN (sACN) \\
Art-Net 4 & Art-Net 4 Specification (Protocol Release) \\
\bottomrule
\end{tabularx}

\nocite{rfc2119,rfc8174,rfc3550,e1312018,artnet4}
\printbibliography

\end{document}
